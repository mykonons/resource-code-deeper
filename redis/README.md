# Redis
## 常用数据结构
String字符串，Hash哈希表，List列表，Set集合，ZSet有序集合
hash结构就是设置key为hash值
list结构是保存一个列表，比方弹幕、消息列表
set集合是保存不重复的列表，比方粉丝列表
zset也叫sorted set，多了一个score值，用来做排序用的，比方排行榜，热门榜单
## 什么是缓存穿透，如何解决
缓存穿透是请求访问redis不存在的key，需要从数据库中读取后，写入redis。当大量这样的请求发起，会压垮数据库。
解决方案：
- 当key不存在，可以在redis写入一个过期时间短的null值，用于当大量请求查询同一个key时的替换值。
- 布隆过滤器，将可能的数据放到一个bitmap中，当有这样的数据查询就去查询bitmap，可以将不存在的数据拦截掉。
## 什么是缓存雪崩，如何解决
缓存雪崩是短时间大量key失效，导致所有请求转向数据库，导致数据库压力过大。
解决方案：
- 在设置过期时间时，加一个随机值，这样使得不会在同一时间失效
- 双缓存机制，A设置过期时间，B不设置过期时间。如果A没有读取到值，则读B。然后将B的数据异步更新到A。
## 过期清除策略和淘汰机制
redis的清除策略分为：定期清除和惰性清除。
- 定期清除是随机选择一部分过期的key进行清除。之所以不是全局的扫描，是因为全局扫描耗费性能。
- 惰性清除是等到查询时再来清除。
这就带来一个问题是可能会有大量的过期数据放在redis中，没有被清除。

淘汰机制
有6种+后来的2种。主要分为lru(least recently used)最近最久未使用和lfu(least frequently used)最近最少未使用。
volatile-lfu： 从已设置过期时间的数据集(server.db[i].expires)中挑选最不经常使用的数据淘汰
## TODO 数据一致性、持久化、实验